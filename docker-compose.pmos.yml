version: "3.9"

services:
  pmos:
    build:
      context: ./openclaw
      dockerfile: Dockerfile
    environment:
      # Keep OpenClaw config/workspace in a named volume by pinning HOME into /app.
      HOME: /app
      TERM: xterm-256color

      # Required when binding to LAN (0.0.0.0) behind Traefik.
      OPENCLAW_GATEWAY_TOKEN: "${OPENCLAW_GATEWAY_TOKEN}"

      # Optional model auth (add in Coolify env vars if/when needed).
      CLAUDE_AI_SESSION_KEY: "${CLAUDE_AI_SESSION_KEY:-}"
      CLAUDE_WEB_SESSION_KEY: "${CLAUDE_WEB_SESSION_KEY:-}"
      CLAUDE_WEB_COOKIE: "${CLAUDE_WEB_COOKIE:-}"
    volumes:
      - openclaw-data:/app/.openclaw
    expose:
      - "10001"
    init: true
    restart: unless-stopped
    command:
      [
        "node",
        "openclaw.mjs",
        "gateway",
        "--allow-unconfigured",
        "--bind",
        "lan",
        "--port",
        "10001"
      ]

volumes:
  openclaw-data:
    driver: local
